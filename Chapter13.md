 ## Chapter 13 동시성

1. 동시성이 필요한 이유?
 - 동시성은 무엇과 언제를 분리하는 전략이다. 다중 스레드 프로그램은 시스템의 성능, 응답 시간 등을 높일 수 있다.

2. 동시성에 대한 미신
 - 동시성은 항상 성능을 높여준다.
 - 동시성을 구현해도 설계는 변하지 않는다.
 - 웹 또는 EJB 컨테이너를 사용하면 동시성을 이해할 필요가 없다.

3. 동시성에 대한 타당한 생각
 - 동시성은 다소 부하를 유발한다.
 - 동시성은 복잡하다.
 - 일반적으로 동시성 버그는 재현하기 어렵다.
 - 동시성을 구현하려면 흔히 근본적인 설계전략을 재고해야 한다.

4. 동시성 방어 원칙
 - 단일 책임 원칙 => 동시성 코드는 그 하나만으로도 충분히 어렵다. 다른 코드와 분리하라.
 - 따름 정리 => 자료를 캡슐화하라. 공유 자료를 최대한 줄여라.
 - 따름 정리 => 자료 사본을 사용하라(?)
 - 따름 정리 => 독자적인 스레드로, 가능하면 다른 프로세서에서, 돌려도 괜찮도록 자료를 독립적인 단위로 분할하라.
 - 라이브러리를 이해하라 => 언어가 제공하는 클래스를 검토하라. 자바에서는 java.util.concurrent, java.util.concurrent.atomic, java.util.concurrent.locks를 익혀라.

5. 실행 모델을 이해하라
 - 생산자-소비자 => 생산자, 소비자가 서로에게 시그널을 잘 보낼 수 있도록 신경쓴다.
 - 읽기-쓰기 => 읽기와 쓰기, 처리율과 기아 사이의 적절한 균형잡기가 필요하다.

6. 동기화하는 메서드 사이에 존재하는 의존성을 이해하라
 - 공유 객체 하나에는 메서드 하나만 사용하라.

7. 동기화 하는 부분을 작게 만들어라
 - synchronized 문을 남발하는 코드는 바람직 하지 않지만 임계영역은 반드시 보호하자.

8. 올바른 종료 코드는 구현하기 어렵다.
 - 종료 코드를 개발 초기부터 고민하고 동작하게 초기부터 구현하라. 생각보다 오래 걸린다. 생각보다 어려우므로 이미 나온 알고리즘을 검토하라.

9. 스레드 코드 테스트하기
 - 문제를 노출하는 테스트 케이스를 작성하라. 프로그램 설정과 시스템 설정과 부하를 바꿔가며 자주 돌려라. 테스트가 실패하면 원인을 추적하라. 다시 돌렸더니 통과하더라는 이유로 그냥 넘어가면 절대로 안된다.
 - 시스템 실패를 ‘일회성’이라 치부하지 마라.
 - 스레드 환경 밖에서 생기는 버그와 스레드 환경에서 생기는 버그를 동시에 디버깅하지 마라. 먼저 스레드 환경 밖에서 코드를 올바로 돌려라.
 - 다양한 설정에서 실행할 목적으로 다른 환경에 쉽게 끼워 넣을 수 있게 코드를 구현하라.
 - 처음부터 그리고 자주 모든 목표 플랫폼에서 코드를 돌려라.
 - 보조 코드를 추가하는 ‘직접 구현하기’ , ‘자동화’ 방법을 사용해 코드를 흔들어 오류를 찾아내라.

10. 결론
 - 다중 스레드 코드는 각별히 깨끗하게 코드를 짜야 한다.
